<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>METANIT.COM</title>
</head>
<body>
    <h2>User form</h2>
    <div id="matrixDiv" runat="server"></div>
    <div id="message"></div>
    <div>
        <p>
            Доля скрещиваний: <br />
            <input type="number" name="crossingShare" id="crossingShare" step="0.1" min="0.1" max="1" />
        </p>
        <p>
            Доля турниров: <br />
            <input type="number" name="tournamentsShare" id="tournamentsShare" step="0.1" min="0.1" max="1" />
        </p>
        <p>
            Доля мутаций: <br />
            <input type="number" name="mutationShare" id="mutationShare" step="0.1" min="0.1" max="1" />
        </p>
        <p>
            Число особей при старте: <br />
            <input type="number" name="individNums" id="individNums" />
        </p>
        <p>
            Размер матрицы расстояний: <br />
            <input type="number" name="matrixSize" id="matrixSize" />
        </p>
        <button id="sendBtn">Send</button>
        <button id="generMatrix">Generate Matrix</button>
    </div>
    <div class="collapse" id="table-container"></div>
    <script>
        
        document.getElementById("generMatrix").addEventListener("click", send);
        
        async function send() {
            const response = await fetch("/api/user", {
                method: "POST",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
                body: JSON.stringify({
                    CrossingShare: document.getElementById("crossingShare").value,
                    TournamentsShare: document.getElementById("tournamentsShare").value,
                    MutationShare: document.getElementById("mutationShare").value,
                    IndividNums: document.getElementById("individNums").value,
                    MatrixSize: document.getElementById("matrixSize").value
                })
            });
            const message = await response.json();
            document.getElementById("message").innerText = message.text;
            renderMatrix(message.matrix)
            
        }
        function renderMatrix(matrixString) {
            try {
                matrix = JSON.parse(matrixString);

                if (!Array.isArray(matrix) || !matrix.every(row => Array.isArray(row))) {
                    console.error("Преобразованные данные должны быть матрицей (массивом массивов).");
                    return;
                }

                const container = document.getElementById("table-container");

                if (!container) {
                    console.error("Не найден контейнер с id 'table-container'.");
                    return;
                }

                const table = document.createElement("table");
                table.style.borderCollapse = "collapse";
                table.style.width = "100%";
                table.style.textAlign = "center";

                const headerRow = document.createElement("tr");
                const emptyHeader = document.createElement("th");
                emptyHeader.textContent = ""; 
                emptyHeader.style.backgroundColor = "#f0f0f0";
                emptyHeader.style.border = "1px solid black";
                headerRow.appendChild(emptyHeader);

                for (let i = 0; i < matrix.length; i++) {
                    const th = document.createElement("th");
                    th.textContent = i; 
                    th.style.backgroundColor = "#f0f0f0";
                    th.style.border = "1px solid black";
                    th.style.padding = "4px";
                    headerRow.appendChild(th);
                }
                table.appendChild(headerRow);

                matrix.forEach((row, rowIndex) => {
                    const tr = document.createElement("tr");

                    const th = document.createElement("th");
                    th.textContent = rowIndex; 
                    th.style.backgroundColor = "#f0f0f0";
                    th.style.border = "1px solid black";
                    th.style.padding = "4px";
                    tr.appendChild(th);

                    row.forEach(cell => {
                        const td = document.createElement("td");
                        td.textContent = cell; 
                        td.style.border = "1px solid black";
                        td.style.padding = "4px";
                        tr.appendChild(td);
                    });

                    table.appendChild(tr);
                });

                container.innerHTML = "";
                container.appendChild(table);

            } catch (error) {
                console.error("Error:", error);
            }
        }
    </script>


</body>
</html>